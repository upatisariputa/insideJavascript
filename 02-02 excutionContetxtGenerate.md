# 실행 컨텍스트 생성과정(활성 객체와 변수 객체, 스코프 체인)

```javascript
function execute(param1, param2) {
  var a = 1,
    b = 2;
  function func() {
    return a + b;
  }
  return param1 + param2 + func();
}
execute(3, 4);
```

1. 활성 객체 생성

- 활성 객체 : 자바스크립트 엔진은 해당 컨텍스트에서 실행에 필요한 여러가지 정보를 담을 객체
  엔진 내부에서 접근 가능, 사용자 접근 불가

2. arguments 객체 생성

- 앞서 만들어진 활성 객체는 arguments 프로퍼티로 이 arguments 객체를 참조함

3. 스코프 정보 생성

- 현재 컨텍스트의 유효범위를 나타내는 스코프 정보를 생성
  이 스코프정보는 현재 실행중인 실행 컨텍스트 안에서 연결 리스트와 유사한 형식으로 만들어진다.(현재 컨텍스트에서 특정 변수에 접근해야 할 경우, 이 리스트 활용)
  이 리스트로 현재 컨텍스트의 변수뿐 아니라, 상위 실행 컨텍스트의 변수도 접근 가능하다.(이 리스트에서 찾지 못한 변수는 결국 정의되지 않은 변수에 접근하는 것으로 판단하여 에러를 검출)
  이 리스트를 스코프 체인이라 하는데 [[scope]]프로퍼티로 참조된다.

- 현재 생성된 활성 객체가 스코프 체인의 제일 앞에 추가되며, excute()함수의 인자나 지역 변수 등에 접근할 수 있다.

4. 변수 생성

- 현재 실행 컨텍스트 내부에서 사용되는 지역 변수의 생성이 이루어진다. (활성 객체 === 변수 객체)

- 변수 객체 안에서 호출된 인자는 각각의 프로퍼티가 만들어지고 그 값이 할당된다. (만약 값이 넘겨지지 않았다면 undefined가 할당된다.)
  (함수 안에 정의된 변수와 함수가 생성)
  **위의 과정에서는 변수나 내부 함수를 단지 메모리에 생성하고, 초기화는 각 변수나 함수에 해당하는 표현식이 실행되기 전까지는 이루어지지 않는다.**
  따라서 변수에는 먼저 undefined가 할당된다. 표현식의 실행은 변수 객체 생성이 다 이루어진 후 시작된다.

5. this 바인딩

- 마지막 단계에서는 this 키워드를 사용하는 값이 할당된다. 여기서 this가 참조하는 객체가 없으면 전역객체를 참조한다.

6. 코드 실행

- 위와 같이 하나의 실행 컨텍스트가 생성되고, 변수 객체가 만들어진 후에, 코드에 있는 여러가지 표현식 실행이 이루어진다.
  이렇게 실행되면서 변수의 초기화 및 연산, 또 다른 함수 실행 등이 이루어진다.
  undefined가 할당된 변수 a와 b에도 값이 할당 된다.

- 전역 실행 컨텍스트는 일반적인 실행 컨텍스트와는 약간 다른데, arguments 객체가 없으며, 전역 객체 하나만을 포함하는 스코프 체인이 있다.
  ECMA에 따르면 실행 컨텍스트가 형성되는 세 가지 중 하나로서 전역 코드가 있는데, 이 전역 코드가 실행될 때 생성 되는 컨텍스트가 전역 실행 컨텍스트다.
  전역 실행 컨텍스트는 변수를 초기화하고 이것의 내부 함수는 일반적인 탑 레벨의 함수로 선언된다.
  그리고 전역 실행 컨텍스트의 변수 객체가 전역 객체로 사용된다.
  즉, **전역 실행 컨텍스트에서는 변수객체가 곧 전역 객체이다.** 따라서 전역적으로 선언된 함수와 변수가 전역 객체의 프로퍼티가 된다.
  전역 실행 컨텍스트 역시, this를 전역 객체의 참조로 사용한다.
